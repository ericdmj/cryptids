<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cryptids of the USA</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device width,initial-scale=1">
    <meta name="description" content="" />

    <!-- adding my stylesheet -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Calls for the ArcGIS API's CSS file and JS library. -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.30/"></script>

    <!-- Adding the modules needed for a full-screen map app -->
    <script>  
      
      // sets the AMD modules
      require(["esri/config", "esri/Map", "esri/views/MapView","esri/Basemap","esri/widgets/BasemapGallery","esri/widgets/Expand","esri/widgets/Locate","esri/widgets/Search","esri/Graphic","esri/layers/GraphicsLayer","esri/layers/FeatureLayer","esri/widgets/Editor","esri/widgets/Legend","esri/core/reactiveUtils"], function(esriConfig, Map, MapView, Basemap, BasemapGallery, Expand, Locate, Search, Graphic, GraphicsLayer, FeatureLayer, Editor, Legend, reactiveUtils) {   
        let cryptidLayerView;
        esriConfig.apiKey = "AAPTxy8BH1VEsoebNVZXo8HurA0NJnJge5mvBzdWw05KZVSc-rH0g5ATkOEM72zKXv9kE7x87aUFvshXADkQU53T8CakkL1B1R2r7I2_9kfS1-XHaF7MVYxQ6VLd5p6tEgpzr75twGhsRz6fK1dSQ2ogOJ1_dHzcsbRTtsGi03Zua1qchYuESnptzJ80EJ1mYqWJo3iuugUMeoYeXbWxZQfRu9bQKBf9ibtwnTc5YG16I7WxJOj3SrYYt-VrPMyknXjtAT1_V1XfrGt6";
        // creates the map and assigns initial basemap
        const map = new Map({
          basemap: "arcgis/modern-antique" // Basemap layer service 
        });

        // sets center point (via long and lat) and zoom level
        const view = new MapView({
          map: map,
          center: [-98.583333, 39.833333], // Longitude, latitude
          zoom: 4, // Zoom level
          container: "viewDiv" // Div element
        });

        // adding the constructor for the graphicslayer
        const graphicsLayer = new GraphicsLayer();  
        map.add(graphicsLayer);

        

        
        /*     
        // Adding the constructor for the counties feature layer
        const countiesLayer = new FeatureLayer({
          url: "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/USA_Census_Counties/FeatureServer/0",
          geometryType: "polygon"

        });

        // Adding the feature layer to the map
        map.add(countiesLayer);
       */
        
        
        // creates the search box
        const searchWidget = new Search({
          view: view
        });
        // Adds the search widget below other elements in
        // the top left corner of the view
        view.ui.add(searchWidget, {
          position: "top-right",
          index: 2
        });

        // create the locate button
        const locateBtn = new Locate({
          view: view
        });

        // Add the locate widget to the top left corner of the view
        view.ui.add(locateBtn, {
          position: "top-right"
        });

        // Custom Basemap List
        const customBasemaps = [
            new Basemap({
                portalItem: {
                    id: "67ab7f7c535c4687b6518e6d2343e8a2"  // Ocean Basemap ID
                },
                thumbnailUrl: "https://www.arcgis.com/sharing/rest/content/items/67ab7f7c535c4687b6518e6d2343e8a2/info/thumbnail/thumbnail1561651100093.jpeg" // Correct URL for thumbnail
            }),
            new Basemap({
                portalItem: {
                    id: "826498a48bd0424f9c9315214f2165d4"  // Colored Pencil Basemap ID
                },
                thumbnailUrl: "https://www.arcgis.com/sharing/rest/content/items/826498a48bd0424f9c9315214f2165d4/info/thumbnail/thumbnail1580490854424.jpeg"
            }),
            new Basemap({
                portalItem: {
                    id: "f35ef07c9ed24020aadd65c8a65d3754"  // Modern Antique Basemap ID
                },
                thumbnailUrl: "https://www.arcgis.com/sharing/rest/content/items/f35ef07c9ed24020aadd65c8a65d3754/info/thumbnail/thumbnail1584383047375.jpeg"
            }),
            new Basemap({
                portalItem: {
                    id: "867895a71a1840399476fc717e76bb43"  // Mid-Century Basemap ID
                },
                thumbnailUrl: "https://www.arcgis.com/sharing/rest/content/items/867895a71a1840399476fc717e76bb43/info/thumbnail/thumbnail1563382006810.jpeg"
            }),
            new Basemap({
                portalItem: {
                    id: "75a3ce8990674a5ebd5b9ab66bdab893"  // Newspaper Basemap ID
                },
                thumbnailUrl: "https://www.arcgis.com/sharing/rest/content/items/75a3ce8990674a5ebd5b9ab66bdab893/info/thumbnail/thumbnail1563382193586.jpeg"
            })
        ];

        // builds basemap gallery using custom basemaps
        const basemapGallery = new BasemapGallery({
          view: view,
          source: customBasemaps
        });

        // Create an Expand instance for the basemap gallery and set the content
        // property to the DOM node of the basemap gallery widget
        const bgExpand = new Expand({
          view: view,
          content: basemapGallery
        });

        // Add the expand instance to the ui
        view.ui.add(bgExpand, "top-left");

        /*
        const cryptidsRenderer = {
          "type": "simple",
          "symbol": {
            "type": "picture-marker",
            "url": "https://img.icons8.com/?id=78608&format=png&color=0000AA",
            "width": "30px",
            "height": "30px"
          }
        }
        */

        
        const colorhex = "4D2042";
        
        
        const cryptidsRenderer = {
          type: "unique-value",
          legendOptions: {
            title: "Cryptid Type"
          },
          field: "CryptidType",
          uniqueValueInfos: [{
            value: "bipedalhumanoid",
            label: "Two legs",
            symbol: {
              type: "picture-marker",
              url: "https://img.icons8.com/?id=MPUi3OWjGmbY&format=png&color=" + colorhex,
              width: "30px",
              height: "30px"
            }
          }, {
            value: "quadruped",
            label: "Four legs",
            symbol: {
              type: "picture-marker",
              url: "https://img.icons8.com/?size=100&id=81kgi239Cuwa&format=png&color=" + colorhex,
              width: "30px",
              height: "30px"
            }
          }, {
            value: "wings",
            label: "Wings",
            symbol: {
              type: "picture-marker",
              url: "https://img.icons8.com/?size=100&id=xjR5QLocktta&format=png&color=" + colorhex,
              width: "30px",
              height: "30px"
            }
          }, {
            value: "fins",
            label: "Fins",
            symbol: {
              type: "picture-marker",
              url: "https://img.icons8.com/?size=100&id=118573&format=png&color=" + colorhex,
              width: "30px",
              height: "30px"
            }
          }, {
            value: "othertype",
            label: "Other",
            symbol: {
              type: "picture-marker",
              url: "https://img.icons8.com/?size=100&id=51Tr6obvkPgA&format=png&color=" + colorhex,
              width: "30px",
              height: "30px"
            }
          }]
        };

        
        //const to make the cryptid labels
        const cryptidLabels = {
          symbol: {
            type: "text",
            color: "#4D2042",
            haloColor: "#F4EEE3",
            haloSize: "1px",
            font: {
              size: "11px",
              family: "Playfair Display",
              weight: "normal",
              style: "italic"
            }
          },
          labelPlacement: "below-center",
          labelExpressionInfo: {
            expression: "$feature.CryptidName"
          }
        };
        
        const clusterConfig = {
          type: "cluster",
          clusterRadius: "100px",
          popupTemplate: {
            title: "Cluster summary",
            content: "This cluster represents {cluster_count} cryptids.",
            fieldInfos: [
              {
                fieldName: "cluster_count",
                format: {
                  places: 0,
                  digitSeparator: true
                }
              }
            ]
          },
          clusterMinSize: "24px",
          clusterMaxSize: "60px",

          symbol: {
            type: "simple-marker",
            style: "circle",
            color: "#b7a5b3",
            outline: {
              color: "rgba(77, 32, 66, 0.5)",
              width: 6
            }
          },

          labelingInfo: [
            {
              deconflictionStrategy: "none",
              labelExpressionInfo: {
                expression: "Text($feature.cluster_count, '#,###')"
              },
              symbol: {
                type: "text",
                color: "#4D2042",
                font: {
                  weight: "bold",
                  family: "Playfair Display",
                  size: "14px"
                }
              },
              labelPlacement: "center-center"
            }
          ]
        };

        //adding the const for the feature layer
        const cryptidsLayer = new FeatureLayer({
        url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/Cryptid_Sighting/FeatureServer",
        
        renderer: cryptidsRenderer, // calling the icon

        featureReduction: clusterConfig, // adding clustering

        labelingInfo: [cryptidLabels], // adding the labels

        outFields: ["CryptidName"]

        });

        //adding the feature layer to the map
        map.add(cryptidsLayer);

        // Set the point layer's LayerInfo
        const pointInfos = {
          layer: cryptidsLayer
        }


        // Loop through the webmap's layers and set an edit configuration for each
        view.map.layers.forEach((layer) => {
            // Specify a few of the fields to edit within the form
            editCryptidsLayer = {
              layer: layer,
              formTemplate: {
                elements: [
                {
                  type: "field",
                  fieldName: "CryptidType",
                  label: "What's its basic body form?"
                },
                {
                  type: "field",
                  fieldName: "CryptidName",
                  label: "Do you know what kind of cryptid it is?"
                },
                {
                  type: "field",
                  fieldName: "Description",
                  label: "Describe the creature you saw:"
                },
                {
                  type: "field",
                  fieldName: "Locomotion",
                  label: "How was it moving?"
                },
                {
                  type: "field",
                  fieldName: "Environment",
                  label: "What were its surroundings like?"
                },
                {
                  type: "field",
                  fieldName: "RecorderName",
                  label: "Your name or initials:"
                },
                {
                  type: "field",
                  fieldName: "SightingDate",
                  label: "Date and time seen:"
                }
                ]
              }
            };
          
        });


        // Create a custom group to separate the different areas of crime.
        // This function takes a 'grouping' object containing a feature template and feature layer.

        function customGroup(grouping) {
            let groupHeading = "What basic form is it? Click the icon and add to the map, and then add details.";
            return groupHeading;
        }


        const editor = new Editor({
            view: view,
            // Pass in the configurations.
            layerInfos: [editCryptidsLayer],
            // Override the default template behavior of the Editor widget
            supportingWidgetDefaults: {
                featureTemplates: {
                groupBy: customGroup
                }
            }
            }); // End Editor constructor



        // Begin Editor constructor
        //const editor = new Editor({
          //view: view,
          //layerInfos: [pointInfos],
          //visibleElements: {
            //settingsMenu: false
          //}
        //}); // End Editor constructor

        // Create an Expand instance for the Editor and set the content
        // property to the DOM node of the Editor widget
        const editorExpand = new Expand({
          view: view,
          content: editor,
          expanded: true
        });

        // Add the expand instance to the ui
        view.ui.add(editorExpand, "top-right");

        // adding a legend
        let legend = new Legend({
          view: view,
          // styles the legend as a card
          style: "card"
        
        });


        // Create an Expand instance for the legend and set the content
        // property to the DOM node of the legend widget
        const legendExpand = new Expand({
          view: view,
          content: legend
        });

        // Add the expand instance to the ui
        view.ui.add(legendExpand, "bottom-left");

        // set an attribute filter on Cryptid Sightings layer view
        function filterByCryptid(event) {
          const selectedCryptid = event.target.getAttribute("CryptidName");
            cryptidLayerView.filter = {
              where: "CryptidName = '" + selectedCryptid + "'"
            };
        }


        const cryptidsNodes = document.querySelectorAll(`.cryptid-item`);
        const cryptidsElement = document.getElementById("cryptids-filter");

        // click event handler for cryptids choices
        cryptidsElement.addEventListener("click", filterByCryptid);

        // User clicked on Winter, Spring, Summer or Fall
        // set an attribute filter on flood warnings layer view
        // to display the warnings issued in that season
        function filterByCryptid(event) {
          const selectedCryptid = event.target.getAttribute("data-cryptid");
          cryptidLayerView.filter = {
            where: "CryptidName = '" + selectedCryptid + "'"
          };
        }

        view.whenLayerView(cryptidsLayer).then((layerView) => {
          // flash flood warnings layer loaded
          // get a reference to the flood warnings layerview
          cryptidLayerView = layerView;

          // set up UI items
          cryptidsElement.style.visibility = "visible";
          const cryptidsExpand = new Expand({
            view: view,
            content: cryptidsElement,
            expandIcon: "filter",
            group: "top-left"
          });

          //clear the filters when user closes the expand widget
          reactiveUtils.when(
            () => !cryptidsExpand.expanded,
            () => {
              cryptidLayerView.filter = null;
            }
          );
          view.ui.add(cryptidsExpand, "top-left");
        });

      });

     </script>

    <!-- CSS to make a full-screen map -->
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #cryptids-filter {
        height: 160px;
        width: 100%;
        visibility: hidden;
      }

      .cryptid-item {
        width: 100%;
        padding: 12px;
        text-align: center;
        vertical-align: baseline;
        cursor: pointer;
        height: 40px;
      }

      .cryptid-item:focus {
        background-color: dimgrey;
      }

      .cryptid-item:hover {
        background-color: dimgrey;
      }

    </style> 
  </head>
  <body>

    <div id="cryptids-filter" class="esri-widget">
      <div class="cryptid-item visible-cryptid" data-cryptid="Aberdeen Wildman">Aberdeen Wildman</div>
      <div class="cryptid-item visible-cryptid" data-cryptid="Bigfoot">Bigfoot</div>
      <div class="cryptid-item visible-cryptid" data-cryptid="Wyvern">Wyvern</div>
      <div class="cryptid-item visible-cryptid" data-cryptid="Chessie">Chessie</div>
    </div>

    <!-- creates pop-up instructions -->
    
    <!-- The div to display the map -->
    <div id="viewDiv">
       <div class="popup">
        <button id="close">&times;</button>
        <h1>Cryptids of the USA</h1>
        <h2>A tool for gathering sightings of mysterious creatures</h2>
        <p>Intro paragraph!</p>
        <p>
            <table id="navigation">
                <tr>
                  <td><img src="images/icon-zoom.gif"></td>
                  <td>&nbsp;</td>
                  <td>Zoom in and out of the map</td>
                </tr>
                <tr>
                  <td><img src="images/icon-basemap.gif"></td>
                  <td></td>
                  <td>Change the basemap layer</td>
                </tr>
                <tr>
                  <td><img src="images/icon-filter.gif"></td>
                  <td></td>
                  <td>Toggle to filter by cryptid name</td>
                </tr>
                <tr>
                  <td><img src="images/icon-legend.gif"></td>
                  <td></td>
                  <td>Open and close the map legend</td>
                </tr>
                <tr>
                  <td><img src="images/address-bar.gif"></td>
                  <td></td>
                  <td>Type in a specific address or location</td>
                </tr>
                <tr>
                  <td><img src="images/icon-locate.gif"></td>
                  <td></td>
                  <td>Center the map on your current location</td>
                </tr>
                <tr>
                  <td><img src="images/icon-editor.gif"></td>
                  <td></td>
                  <td>Toggle the editor window to add/edit data</td>
                </tr>
              </table> 
  
        </p>
        <p>
            Created by Eric Johnson for University of Wisconsin-Madison Geography 576 - Fall 2024
        </p>
        <p>
            Much cryptid info from: <a href="https://cryptidz.fandom.com/wiki/Cryptid_Wiki" target="_blank">Cryptid Wiki</a>
        </p>
        <button id="letsGo">
            <e href="#">Explore!</e>
        </button>
      </div>
    </div> 


    <!--JavaScript Link-->
    <script type="text/javascript" src="js/main.js"></script>
  </body>
</html>
